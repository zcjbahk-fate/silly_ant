---
  <变量更新规则>
变量更新规则:
  # =======================
  # 系统与环境更新规则
  # =======================
  系统:
    时间段:
      头:
        type: z.string().regex(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/)
        check:
          - 更新方式：replace
          - 更新频率：必须每轮更新
          - 常规情况：将值设定为上一轮的"系统.时间段.尾"，保持时间连续
          - 时间跳跃：若剧情明确"几天后/多年后"，直接设定为跳跃后的新时间点
      经过时间:
        type: z.coerce.number().int().nonnegative()
        check:
          - 更新方式：replace
          - 更新频率：必须每轮更新
          - 更新要求：
            - 估算本轮剧情消耗的分钟数
            - 务必保证数值合理
    地点:
      type: z.string()
      check:
        - 更新频率：仅在剧情明确发生空间转移时修改此值
    天气:
      type: z.enum(["晴天", "下雨", "多云", "下雪", "阴天"])
      check:
        - 更新频率：根据环境描写或剧情氛围调整

  # =======================
  # 主角 (User)
  # =======================
  主角:
    性器状态:
      肉棒:
        当前长度:
          type: z.coerce.number().int().nonnegative()
          check:
            - 更新方式：delta
            - 更新频率：
              - NSFW场景中必须更新
              - SFW根据当前剧情中的性刺激程度和剧情调整
            - 设定未勃起时维持在最小值附近，完全勃起时接近最大值
        状态:
          type: z.string()
          check:
            - 更新频率：
              - NSFW场景中必须更新
              - SFW根据当前剧情中的性刺激程度和剧情调整
        描述:
          type: z.string()
          check:
            - 更新频率：长度或状态改变时必须更新
            - 更新要求：根据当前的长度、状态和剧情，生成一段简短的白描
            - 更新示例：
              - 青筋暴起，龟头紫红
              - 在内裤中疲软蜷缩

    持有重要物品:
      ${物品名}:
        数量:
          type: z.coerce.number().int().nonnegative()
          check:
            - 更新频率：仅在剧情明确发生物品获得、购买、消耗或丢失时调整

    技能:
      ${技能名}:
        type: z.string()
        check:
          - 更新频率：仅在<user>习得新技能或现有技能发生质变（如升级、失效）时更新描述

    性经历:
      ${角色名}:
        ${口交|足交|插入|肛交|手交}:
          type: z.coerce.number().int().nonnegative()
          check:
            - 更新频率：仅当<user>在与该角色的对应性行为中**达到射精/高潮**时，计数+1
            - 更新要求：
              - 若仅是过程描写、未射精的中断、或单纯的挑逗，**不要增加计数**
              - 必须准确识别互动的对象和具体的方式

    对角色已知:
      ${角色名}:
        type: z.string()
        check:
          - 更新频率：当<user>通过观察、对话或事件获得关于该角色的新信息时更新
          - 更新要求：将新获取的信息追加到现有描述中，用" / "分隔

    对角色未知:
      ${角色名}:
        type: z.string()
        check:
          - 更新频率：
            - 当<user>产生新的疑问或发现新的谜团时，添加新的未知项
            - 当角色做了某些不为主角所知的事情时，添加新的未知项
          - 更新要求：当原本未知的信息被揭示（转为已知）时，移除该部分描述

  # =======================
  # 角色列表动态管理
  # =======================
  角色:
    type: z.string()
    check:
      - 自动扫描剧情中出现的、尚未记录在案的**女性**角色
      - **触发新增的条件**：当且仅当该女性角色与主角发生了重要互动，**特别是发生了性关系**（亲吻、爱抚、性交等）时，必须新增该角色
      - **过滤条件**：**严禁**新增男性角色
      - **初始化**：新增角色时，需根据剧情描述自动填入衣物、外貌、性格及初始数值

  # =======================
  # 角色通用更新规则
  # =======================
  角色.${角色名}:
    好感度:
      type: number
      range: 0~100
      check:
        - 更新频率：必须每轮更新
        - 定义：代表角色对<user>的情感倾向与信任程度。低分代表厌恶/仇视，高分代表爱慕/依恋。
        - 增加：符合利益(+5~10)、深度共鸣(+3~6)、安抚保护(+4~8)
        - 减少：伤害尊严(-5~10)、嫉妒(-3~6)、欺骗(-4~8)
        - M属性特殊：受虐/羞辱时可能反升(+2~5)
        - 数值联动：
          - NTR值>60时，好感度每次额外减少

    堕落度:
      type: number
      range: 0~100
      check:
        - 更新频率：必须每轮更新
        - 定义：代表角色背离社会常规道德、接受淫乱/变态行为的程度。低分代表保守/贞烈，高分代表淫乱/无底线。
        - 增加：突破底线性行为(+5~10)、被迫羞耻任务(+3~7)、公开展露(+4~8)
        - 减少：长期脱离性环境(-1~3)、严重创伤导致抗拒(-5~10)
        - 数值联动：
          - NTR值>60时，堕落度每次额外增加

    性欲值:
      type: number
      range: 0~100
      check:
        - 更新频率：必须每轮更新
        - 定义：代表角色当前的生理性冲动和心理渴求程度。低分代表冷静/冷淡，高分代表发情/饥渴。
        - 增加：直接性刺激(+10~20)、药物/环境(+15~30)、生理周期(+1~3)
        - 减少：高潮满足后(-20~50)、惊吓/厌恶(-10~30)
        - 特殊：若堕落度极高(80+)，羞辱可能转化为兴奋(+3~6)


    # 衣物与装备
    ${上身|下身|腿部|鞋子|配饰}:
      type: |-
        {
          名称: string;
          状态: string;
        }
      check:
        - 当衣物发生破损、位移、滑落、部分脱下等**非更换**变动时，仅需更新“状态”字段。
        - “状态”字段的描述必须详细具体，严禁使用模糊或抽象词汇。示例状态如：“领口被撕裂露出锁骨”、“裙摆被掀起堆在腰间”、“丝袜褪至脚踝处挂着”、“内裤挂在单边膝盖上摇晃”、“被撕成布条散落在地”。
        - 仅在角色**完全更换**该部位衣物（如更衣、衣物彻底脱落）时，才可更新“名称”字段，且此时应将“状态”重置为“穿着整齐”或“未脱”。
        - 仅在身体特征发生永久性改变时更新（如：新增纹身、穿孔、伤疤、穿戴贞操锁）

    当前姿势:
      type: z.string()
      check:
        - 更新频率：必须每轮更新
        - 实时更新动作定格（如：跪在地上/靠在墙边/骑乘位）

    # NTR相关
    NTR关系.数值:
      type: number
      range: 0~100
      check:
        - 更新频率：必须每轮更新
        - 定义：代表角色心向背离<user>、倾向于建立多角关系或享受背德感的程度。低分代表忠诚/专一，高分代表放荡/渴望外遇/乐于看着主角受辱。
        - 数值增加：与其他男性亲密(+10~25)、对比<user>劣势(+5~10)、鄙视<user>(+3~8)
        - 数值减少：被<user>征服(-10~20)、对其他男性幻灭(-5~15)
        - 数值联动：
          - 堕落度>60时，NTR值每次额外增加

    # 精液系统
    体内精液.${来源人名}:
      type: |-
        {
          量: number; // ml
          状态: string;
        }
      check:
        - 依据剧情更新，当量大于0时，每轮更新
        - 注入：当该来源对象在角色体内射精时，量增加（通常量为+3~10ml）
        - 流出：随时间流逝或剧烈运动减少（通常量为-0.3~2ml），量多时减少越多，之后衰退

    # 历史记录
    上次做爱:
      type: |-
        {
          时间: string;
          对象: string;
          地点: string;
          方式: string;
        }
      check:
        - 依据剧情更新
        - 仅在一段完整的性行为结束（射精或力竭）后更新此记录

    性经历.${对象名}.${口交|足交|插入|肛交|手交}:
      type: z.coerce.number().int().nonnegative()
      check:
        - 依据剧情更新
        - 仅当与该角色发生关系的对象**射精/高潮**时，计数+1
        - 若仅是过程描写、未射精的中断、或单纯的挑逗，**不要增加计数**
        - 必须准确识别互动的对象和具体的方式

    # 心理活动
    内心想法:
      type: z.string()
      check:
        - 每轮更新
        - 必须根据当前情境实时生成角色的真实心声
        - 使用第一人称

    对主角看法:
      type: z.string()
      check:
        - 每轮更新
        - 依据剧情中<user>对角色产生的印象

    对主角已知:
      type: z.string()
      check:
        - 依据剧情更新
        - 当角色通过观察、对话或事件获得关于<user>新信息时更新
        - 将新获取的信息追加到现有描述中，用" / "分隔

    对主角未知:
      type: z.string()
      check:
        - 依据剧情更新
        - 当原本未知的信息被揭示（转为已知）时，移除该部分描述
        - 当角色产生新的疑问或发现新的谜团时，添加新的未知项
        - 当<user>做了某些不为角色所知的事情时，添加新的未知项
  </变量更新规则>
